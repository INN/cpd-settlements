/**
 * jQuery serializeObject
 * @copyright 2014, macek <paulmacek@gmail.com>
 * @link https://github.com/macek/jquery-serialize-object
 * @license BSD
 * @version 2.5.0
 */
!function(e,i){if("function"==typeof define&&define.amd)define(["exports","jquery"],function(e,r){return i(e,r)});else if("undefined"!=typeof exports){var r=require("jquery");i(exports,r)}else i(e,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,i){function r(e,r){function n(e,i,r){return e[i]=r,e}function a(e,i){for(var r,a=e.match(t.key);void 0!==(r=a.pop());)if(t.push.test(r)){var u=s(e.replace(/\[\]$/,""));i=n([],u,i)}else t.fixed.test(r)?i=n([],r,i):t.named.test(r)&&(i=n({},r,i));return i}function s(e){return void 0===h[e]&&(h[e]=0),h[e]++}function u(e){switch(i('[name="'+e.name+'"]',r).attr("type")){case"checkbox":return"on"===e.value?!0:e.value;default:return e.value}}function f(i){if(!t.validate.test(i.name))return this;var r=a(i.name,u(i));return l=e.extend(!0,l,r),this}function d(i){if(!e.isArray(i))throw new Error("formSerializer.addPairs expects an Array");for(var r=0,t=i.length;t>r;r++)this.addPair(i[r]);return this}function o(){return l}function c(){return JSON.stringify(o())}var l={},h={};this.addPair=f,this.addPairs=d,this.serialize=o,this.serializeJSON=c}var t={validate:/^[a-z_][a-z0-9_]*(?:\[(?:\d*|[a-z0-9_]+)\])*$/i,key:/[a-z0-9_]+|(?=\[\])/gi,push:/^$/,fixed:/^\d+$/,named:/^[a-z0-9_]+$/i};return r.patterns=t,r.serializeObject=function(){return new r(i,this).addPairs(this.serializeArray()).serialize()},r.serializeJSON=function(){return new r(i,this).addPairs(this.serializeArray()).serializeJSON()},"undefined"!=typeof i.fn&&(i.fn.serializeObject=r.serializeObject,i.fn.serializeJSON=r.serializeJSON),e.FormSerializer=r,r});
;function languagize(a){return a<10&&(0==a&&(a="no"),1==a&&(a="one"),2==a&&(a="two"),3==a&&(a="three"),4==a&&(a="four"),5==a&&(a="five"),6==a&&(a="six"),7==a&&(a="seven"),8==a&&(a="eight"),9==a&&(a="nine")),a}function findOfficer(a){for(i=0;i<officers_json.length;i++){var b=officers_json[i];if(b.slug==a)return b}}function getOfficerData(a,b){return b.filter(function(b){return b.slug==a})}function getCases(a){for(var b=[],c=0;c<cases_json.length;c++){var d=cases_json[c];getOfficerData(a,d.officers).length>0&&b.push(d)}return b}function case_twitter(a){var b,c=$(a).closest(".case, .case-detail"),d=c.find("h2").text(),e=c.find("h3").text().toLowerCase();b=c.find("a.case-link").get(0)?c.find("a.case-link").get(0).href:window.location.href;var f="This police lawsuit for "+e+" cost Chicago "+d+". "+b+" via @chicagoreporter",g="https://twitter.com/home?status="+encodeURIComponent(f);window.open(g,"newwindow","width=600, height=400")}function case_facebook(a){var b,c=$(a).closest(".case, .case-detail");c.find("h2").text();b=c.find("a.case-link").get(0)?c.find("a.case-link").get(0).href:window.location.href;var d="https://www.facebook.com/sharer/sharer.php?u="+b;window.open(d,"newwindow","width=600, height=400")}function officer_twitter(a){var b,c=$(a).closest(".officer"),d=c.data("slug"),e=findOfficer(d);if(b=c.find("a.officer-link").get(0)?c.find("a.officer-link").get(0).href:window.location.href,e){var f="",g=e.first+" "+e.last,h=e.total_payments.formatMoney(0),i=getCases(d).length;f=1==i?toTitleCase(g)+" was named in one police misconduct lawsuit that cost Chicago $"+h+". "+b+" via @chicagoreporter":toTitleCase(g)+" was named in "+languagize(i)+" police misconduct lawsuits that cost Chicago $"+h+". "+b+" via @chicagoreporter"}var j="https://twitter.com/home?status="+encodeURIComponent(f);window.open(j,"newwindow","width=600, height=400")}function officer_facebook(a){var b,c=$(a).closest(".officer");b=c.find("a.officer-link").get(0)?c.find("a.officer-link").get(0).href:window.location.href;var d="https://www.facebook.com/sharer/sharer.php?u="+b;window.open(d,"newwindow","width=600, height=400")}function split_tags(a){for(var a=a.split("|"),b="",c=0;c<a.length;c++){var d=a[c];b+="LGBT"!==d?"<span class='display-tag'>"+d.toLowerCase()+"</span>":"<span class='display-tag'>"+d+"</span>"}return b}function toTitleCase(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})}function adjust_whitespace(){for(var a=$(".clickable.tag"),b=0;b<a.length;b++){var c=$(a[b]),d=c.html();d=d.replace(/(\r\n|\n|\r)/gm,"").replace(/ +(?= )/g,""),d=d.replace(" .","."),d=d.replace(" ,",","),d=d.replace(" <sp","<sp"),c.html(d)}}function set_cookie(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="; expires="+d.toGMTString()}else var e="";document.cookie=a+"="+b+e+"; path=/"}function get_cookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null}function erase_cookie(a){set_cookie(a,"",-1)}Number.prototype.formatMoney=function(a,b,c){var d=this,a=isNaN(a=Math.abs(a))?2:a,b=void 0==b?".":b,c=void 0==c?",":c,e=d<0?"-":"",f=parseInt(d=Math.abs(+d||0).toFixed(a))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+c:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+c)+(a?b+Math.abs(d-f).toFixed(a).slice(2):"")},$(document).ready(function(){$(".menu-toggle-wrap").click(function(){$(this).closest("#main-menu").toggleClass("expanded")}),$(".mobile-tab-selector li.cases").click(function(){$("body").hasClass("filter-cases")||$(".tab-selector .cases a").trigger("click")}),$(".mobile-tab-selector li.officers").click(function(){$("body").hasClass("filter-officers")||$(".tab-selector .officers a").trigger("click")}),$("#explore-data").click(function(){var a=$(".search");$(this).find("span");a.toggleClass("expanded")}),$("#replay-intro").click(function(){window.location.href=site_path}),$("label.option").hover(function(){var a=$(this).find("span"),b=$(this);a.css("display","inline");var c=b.width()-a.width();c<-4&&a.css({left:c,width:a.width+c})},function(){$(this).find("span").css({left:"",display:"block"})})}),$(window).resize(function(){$(this).width()>=820&&($("#tag-toggle").removeClass("expanded"),$("#tag-group").attr("style",""),$("#main-menu").removeClass("expanded"))});;!function(){function b(b){var c=[],d=b;for(a in d)c.push(d[a]);return c.sort(function(a,b){var c=Date.parse(a.date_of_incident),d=Date.parse(b.date_of_incident);return c<d?1:c>d?-1:0}),c}function c(b){var c=[],d=b;for(a in d)c.push(d[a]);return c.sort(function(a,b){var c=a.last.toLowerCase(),d=b.last.toLowerCase();return c<d?-1:c>d?1:0}),c}function d(){if(window.location.href.match(/(search|case|officer)/)){get_cookie("cpd-disclaimer")||e(),set_cookie("cpd-disclaimer",1,7)}}function e(){f("body").append('<div class="disclaimer-overlay"><div class="disclaimer-container"><div class="disclaimer-close">close</div><h3>Disclaimer</h3><p>This database of civil police misconduct claims aims to summarize the complaint, the Chicago police officers named, and the settlement/judgment amount, and does not purport to summarize the entire legal proceeding. Defendants typically deny the allegations in a complaint, and a settlement or judgment is not an indication that every allegation is true. This database does not reflect the additional, non-Chicago police officer defendants who may have been named in the case or the specific claims that remained at the end of each case. For full credits and methodology, <a href="http://projects.chicagoreporter.com/settlements/about.html">click here</a>.</p><div class="disclaimer-button">I understand.</div></div></div>');var a=f(".disclaimer-overlay");f(".disclaimer-button").click(function(){a.remove()})}var f=jQuery,g=Backbone.Router.extend({routes:{search:"cases","search/":"cases","search/index.html":"cases","search/officers":"officers","search/cases":"cases","search/officers/":"officers","search/officers/index.html":"officers","search/cases/":"cases","search/cases/index.html":"cases","case/*path":"case_detail","officer/*path":"officer_detail"},initialize:function(){var a=this;return this.caseCollection=new i,this.caseList=new m({el:"#case-list-view",cases:this.caseCollection}),this.officerCollection=new k,this.officerList=new n({el:"#officer-list-view",officers:this.officerCollection}),this.searchSelector=new s({el:"#tabs",cases:this.caseCollection,caseList:this.caseList,officers:this.officerCollection,officerList:this.officerList}),this.loadData(function(){sessionStorage.setItem("cases",JSON.stringify(cases_json)),sessionStorage.setItem("officers",JSON.stringify(officers_json)),cases_json=b(cases_json),officers_json=c(officers_json);for(var d=cases_json.length,e=0,g=0;g<d;g++)e+=cases_json[g].total_payments;f("#search-intro").text("These "+d+" lawsuits cost Chicago a total of $"+Number(e).formatMoney(0)+"."),a.officerCollection=a.officerCollection.reset(officers_json),a.caseCollection=a.caseCollection.reset(cases_json)}),Backbone.Router.prototype.initialize.apply(this,arguments),this},loadData:function(a){if(sessionStorage.getItem("cases")){cases_json=b(JSON.parse(sessionStorage.getItem("cases"))),officers_json=c(JSON.parse(sessionStorage.getItem("officers")));for(var d=cases_json.length,e=0,g=0;g<d;g++)e+=cases_json[g].total_payments;f("#search-intro").text("These "+d+" lawsuits cost Chicago a total of $"+Number(e).formatMoney(0)+"."),this.officerCollection=this.officerCollection.reset(officers_json),this.caseCollection=this.caseCollection.reset(cases_json)}else if("undefined"==typeof cases_json&&"undefined"==typeof officers_json){var h=site_path+"assets/cpd_settlements/data/combined.min.js";f.ajax({url:h,cache:!0,dataType:"script",success:a})}},officers:function(){return this.searchSelector.goToTab("officers"),!1},officer_detail:function(){return this.searchSelector.goToTab("officers",!0),!1},cases:function(){return this.searchSelector.goToTab("cases"),!1},case_detail:function(){return this.searchSelector.goToTab("cases",!0),!1}}),h=Backbone.Model.extend({}),i=Backbone.Collection.extend({model:h}),j=Backbone.Model.extend({}),k=Backbone.Collection.extend({model:j,comparator:"last"}),l=Backbone.Model.extend({}),j=(Backbone.Collection.extend({model:l,comparator:"neighborhood"}),Backbone.Model.extend({})),k=Backbone.Collection.extend({model:j}),m=Backbone.View.extend({cases:new i,case_numbers:[],initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.template=_.template(f("#case-tmpl").html()),this.cases=a.cases,this.cases.on("reset",this.render.bind(this)),this.listSorter=new r({caseList:this,el:"#case-list-sort"}),this.render(),this},render:function(){var a=this,b="";return this.cases.length?(this.$el.html(""),this.cases.each(function(c){b+=a.template({model:c.toJSON()})}),this.$el.html(b)):this.$el.html('<div class="loading">Loading...</div>'),this},sortElements:function(a){var b;switch(a){case"payment-low-high":b=this.lowtohigh;break;case"payment-high-low":b=this.hightolow;break;case"date-newest-oldest":b=this.newtoold;break;case"date-oldest-newest":b=this.oldtonew;break;default:b=this.newtoold}var c=this.$el.children(".case");c.sort(b),c.detach().appendTo(this.$el)},renderFiltered:function(a){a?this.case_numbers=a:a=this.case_numbers;var b=this;return this.$el.find(".case").hide(),_.each(a,function(a){b.$el.find('[data-case_number="'+a+'"]').show()}),this},hightolow:function(a,b){var c=Number(f(a).data("total_payments")),d=Number(f(b).data("total_payments"));return c<d?1:c>d?-1:0},lowtohigh:function(a,b){var c=Number(f(a).data("total_payments")),d=Number(f(b).data("total_payments"));return c<d?-1:c>d?1:0},newtoold:function(a,b){var c=Date.parse(f(a).data("date_of_incident")),d=Date.parse(f(b).data("date_of_incident"));return c<d?1:c>d?-1:0},oldtonew:function(a,b){var c=Date.parse(f(a).data("date_of_incident")),d=Date.parse(f(b).data("date_of_incident"));return c<d?-1:c>d?1:0},formatStr:function(a){var b="";return b=a.match(/^(\r\n|.){1,220}\b/g).join("")," "==b.substring(b.length-1)&&(b=b.substring(0,b.length-1)),","==b.substring(b.length-1)&&(b=b.substring(0,b.length-1)),"-"==b.substring(b.length-1)&&(b=b.substring(0,b.length-1)),b+='...<span class="read-more">Read More&nbsp;&raquo; </span>'}}),n=Backbone.View.extend({officers:new k,initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.officers=a.officers,this.officers.on("reset",this.render.bind(this)),this.template=_.template(f("#officer-tmpl").html()),this.render(),this},render:function(){var a=this,b="";return this.$el.html(""),this.officers.length?(this.officers.each(function(c){b+=a.template({model:c.toJSON()})}),this.$el.html(b)):this.$el.html('<div class="loading">LOADING...</div>'),this}}),o=Backbone.View.extend({initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.officerList=a.officerList,this.officers=a.officers,this.initTypeahead(),this},initTypeahead:function(){var a=this;f(".typeahead").keyup(function(){var b=f(".detail-page"),c=f("detail-officer"),d=f("detail-case"),e=f(this).val().toLowerCase();e.length>0?(f(".officer").each(function(){a.filterOfficers(this,e)}),b&&(f("body").removeClass("detail-page"),f("body").removeClass("detail-case"),f("body").removeClass("detail-officer"))):c.length>0?(f("body").addClass("detail-page"),f("body").addClass("detail-officer"),f(".officer").show()):d>0?(f("body").addClass("detail-page"),f("body").addClass("detail-case")):f(".results-wrapper-inner .officer").show()})},filterOfficers:function(a,b){var c=f(a),d=c.find("h2"),e=c.find(".badge-num"),g=c.find(".slug");(d.text()+e.text()+g.text()).toLowerCase().indexOf(b)>=0?c.show():c.hide()}}),p=Backbone.View.extend({initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.filterData=a.filterData,this.template=_.template(f("#case-search-statement-tmpl").html()),this.caseList=a.caseList,this},render:function(){if(void 0===this.filterData)return!1;var a=this,b=_.extend(this.filterData,{incidents:this.languagize(this.caseList.case_numbers.length),payments:_.reduce(this.caseList.cases.filter(function(b){if(_.indexOf(a.caseList.case_numbers,b.get("case_number"))>=0)return b}),function(a,b){return a+b.get("total_payments")},0)}),c=this.template(b);this.$el.html(c.trim()),f("#search-intro").hide()},languagize:function(a){return a<10&&(0==a&&(a="no"),1==a&&(a="one"),2==a&&(a="two"),3==a&&(a="three"),4==a&&(a="four"),5==a&&(a="five"),6==a&&(a="six"),7==a&&(a="seven"),8==a&&(a="eight"),9==a&&(a="nine")),a}}),q=Backbone.View.extend({events:{"change :input":"handleChange"},initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.filterData=this.$el.serializeObject(),this.cases=a.cases,this.caseList=a.caseList,this.initChosen(),this.initTags(),this},handleChange:function(){this.filterData=this.$el.serializeObject(),this.filterCases(),this.updateStatement(),f(".search").removeClass("expanded"),f("body").removeClass("detail-page"),f("body").removeClass("detail-case"),f("body").removeClass("detail-officer")},updateStatement:function(){void 0===this.caseSearchStatement&&(this.caseSearchStatement=new p({filterdata:this.filterData,el:"#case-search-statement",caseList:this.caseList})),this.caseSearchStatement.filterData=this.filterData,this.caseSearchStatement.render(),adjust_whitespace();var a=f(".clear-filters"),b=f(".filter-statement").hide(),c=f(".search-statement-wrapper");""==this.filterData.neighborhood&&""==this.filterData.primary_causes[0]&&""==this.filterData.total_payments&&f("#case-search-form input[type=checkbox]:checked").length<1?(a.hide(),b.hide(),c.removeClass("filtered")):(a.show(),b.show(),c.addClass("filtered")),f(".clickable .x").click(function(){var a=(f(this),f(this).closest(".clickable.neighborhood").length),b=f(this).closest(".clickable.payment_amount").length,c=f(this).closest(".clickable.primary_cause").length,d=f(this).closest(".clickable.tag").length;if(a>0)f("#neighborhood").chosen().prop("selectedIndex",0).change().trigger("chosen:updated");else if(b>0)f("#payment_amount").chosen().prop("selectedIndex",0).change().trigger("chosen:updated");else if(c>0)f("#primary_cause").chosen().prop("selectedIndex",0).change().trigger("chosen:updated");else if(d>0){var e=f(this).parent().data("val");f("#case-search-form input[type=checkbox]:checked").each(function(){var a=f(this),b=f(this).val().toLowerCase();e==b&&a.attr("checked",!1).change()})}}),a.click(function(){f("#case-search-form input[type=checkbox]:checked").attr("checked",!1).change(),f("#case-search-form select").chosen().prop("selectedIndex",0).change().trigger("chosen:updated"),f(".typeahead").val("").trigger("keyup"),a.unbind("click")})},filterCases:function(){var a=this,b=[];this.cases.each(function(c){var d=!0;_.each(a.filterData,function(a,b){if(""!=a){if(["neighborhood"].indexOf(b)>=0&&"neighborhood"==b&&("unknown"==a?void 0!==c.get(b)&&(d=!1):c.get(b)!==a&&(d=!1)),"total_payments"==b){var e=a.split("-"),g=Number(e[0]),h=Number(e[1]),i=Number(c.get("total_payments"));i>=g&&i<=h||(d=!1)}if("primary_causes"==b&&a.indexOf(c.get("primary_cause"))<0&&(d=!1),"tags"==b){var j=c.get("tags").toLowerCase(),k=!0;f("input:checked").each(function(){var a=f(this).attr("value");if(!(j.indexOf(a)>=0))return k=!1,!1;k=!0}),k||(d=!1)}}}),d&&b.push(c.get("case_number"))}),this.caseList.renderFiltered(b)},initChosen:function(){this.$el.find("select.chosen").chosen()},initTags:function(){f("#tag-toggle").click(function(){f(this).toggleClass("expanded"),f("#tag-group").toggle()})}}),r=Backbone.View.extend({initialize:function(a){return this.$el.chosen({width:"200px",disable_search:!0}),this.caseList=a.caseList,this.caseList.cases.on("sort",this.caseList.renderFiltered.bind(this.caseList)),Backbone.View.prototype.initialize.apply(this,arguments),this},events:{change:"sortCaseList"},sortCaseList:function(a){var b=f(a.currentTarget).val();this.caseList.sortElements(b)}}),s=Backbone.View.extend({events:{"click .tab-selector a":"goToTab"},initialize:function(a){return this.cases=a.cases,this.caseList=a.caseList,this.officers=a.officers,this.officerList=a.officerList,Backbone.View.prototype.initialize.apply(this,arguments),this},goToTab:function(a,b){d();var c;if(c="string"==typeof a?"search/"+a:f(a.currentTarget).attr("href").replace(Backbone.history.root,""),"cases"==a?(f("body").removeClass("filter-officers"),f("body").addClass("filter-cases"),void 0===this.caseForm&&(this.caseForm=new q({el:"#case-search-form",cases:this.cases,caseList:this.caseList})),this.caseForm.filterCases()):(f("body").removeClass("filter-cases"),f("body").addClass("filter-officers"),void 0===this.officerForm&&(this.officerForm=new o({el:"#officer-search-form",officers:this.officers,officerList:this.officerList}))),!b)return Backbone.history.navigate(c,{trigger:!0}),!1}});Number.prototype.formatMoney=function(a,b,c){var d=this,a=isNaN(a=Math.abs(a))?2:a,b=void 0==b?".":b,c=void 0==c?",":c,e=d<0?"-":"",f=parseInt(d=Math.abs(+d||0).toFixed(a))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+c:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+c)+(a?b+Math.abs(d-f).toFixed(a).slice(2):"")},f(document).ready(function(){window.router=new g,Backbone.history.start({pushState:!0,root:site_path}),f(window).keydown(function(a){if(13==a.keyCode&&!a.target.href)return a.preventDefault(),f("#tap-to-close").click(),!1})})}();