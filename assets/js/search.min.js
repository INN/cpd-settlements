!function(){function b(b){var c=[],d=b;for(a in d)c.push(d[a]);return c.sort(function(a,b){var c=Date.parse(a.date_of_incident),d=Date.parse(b.date_of_incident);return d>c?1:c>d?-1:0}),c}function c(b){var c=[],d=b;for(a in d)c.push(d[a]);return c.sort(function(a,b){var c=a.last.toLowerCase(),d=b.last.toLowerCase();return d>c?-1:c>d?1:0}),c}var d=jQuery,e=Backbone.Router.extend({routes:{search:"cases","search/":"cases","search/index.html":"cases","search/officers":"officers","search/cases":"cases","search/officers/":"officers","search/officers/index.html":"officers","search/cases/":"cases","search/cases/index.html":"cases","case/*path":"case_detail","officer/*path":"officer_detail"},initialize:function(){var a=this;return this.caseCollection=new g,this.caseList=new k({el:"#case-list-view",cases:this.caseCollection}),this.officerCollection=new i,this.officerList=new l({el:"#officer-list-view",officers:this.officerCollection}),this.searchSelector=new q({el:"#tabs",cases:this.caseCollection,caseList:this.caseList,officers:this.officerCollection,officerList:this.officerList}),this.loadData(function(){cases_json=b(cases_json),officers_json=c(officers_json);for(var e=cases_json.length,f=0,g=0;e>g;g++)f+=cases_json[g].total_payments;d("#search-intro").text("These "+e+" lawsuits cost Chicago a total of $"+Number(f).formatMoney(0)+"."),a.officerCollection=a.officerCollection.reset(officers_json),a.caseCollection=a.caseCollection.reset(cases_json)}),Backbone.Router.prototype.initialize.apply(this,arguments),this},loadData:function(a){if("undefined"==typeof cases_json&&"undefined"==typeof officers_json){var b=site_path+"assets/cpd_settlements/data/combined.min.js";d.ajax({url:b,cache:!0,dataType:"script",success:a})}},officers:function(){return this.searchSelector.goToTab("officers"),!1},officer_detail:function(){return this.searchSelector.goToTab("officers",!0),!1},cases:function(){return this.searchSelector.goToTab("cases"),!1},case_detail:function(){return this.searchSelector.goToTab("cases",!0),!1}}),f=Backbone.Model.extend({}),g=Backbone.Collection.extend({model:f}),h=Backbone.Model.extend({}),i=Backbone.Collection.extend({model:h,comparator:"last"}),j=Backbone.Model.extend({}),h=(Backbone.Collection.extend({model:j,comparator:"neighborhood"}),Backbone.Model.extend({})),i=Backbone.Collection.extend({model:h}),k=Backbone.View.extend({cases:new g,case_numbers:[],initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.template=_.template(d("#case-tmpl").html()),this.cases=a.cases,this.cases.on("reset",this.render.bind(this)),this.listSorter=new p({caseList:this,el:"#case-list-sort"}),this.render(),this},render:function(){var a=this,b="";return this.cases.length?(this.$el.html(""),this.cases.each(function(c){b+=a.template({model:c.toJSON()})}),this.$el.html(b)):this.$el.html('<div class="loading">Loading...</div>'),this},sortElements:function(a){var b;switch(a){case"payment-low-high":b=this.lowtohigh;break;case"payment-high-low":b=this.hightolow;break;case"date-newest-oldest":b=this.newtoold;break;case"date-oldest-newest":b=this.oldtonew;break;default:b=this.newtoold}var c=this.$el.children(".case");c.sort(b),c.detach().appendTo(this.$el)},renderFiltered:function(a){a?this.case_numbers=a:a=this.case_numbers;var b=this;return this.$el.find(".case").hide(),_.each(a,function(a){b.$el.find('[data-case_number="'+a+'"]').show()}),this},hightolow:function(a,b){var c=Number(d(a).data("total_payments")),e=Number(d(b).data("total_payments"));return e>c?1:c>e?-1:0},lowtohigh:function(a,b){var c=Number(d(a).data("total_payments")),e=Number(d(b).data("total_payments"));return e>c?-1:c>e?1:0},newtoold:function(a,b){var c=Date.parse(d(a).data("date_of_incident")),e=Date.parse(d(b).data("date_of_incident"));return e>c?1:c>e?-1:0},oldtonew:function(a,b){var c=Date.parse(d(a).data("date_of_incident")),e=Date.parse(d(b).data("date_of_incident"));return e>c?-1:c>e?1:0},formatStr:function(a){var b="";return b=a.match(/^(\r\n|.){1,220}\b/g).join("")," "==b.substring(b.length-1)&&(b=b.substring(0,b.length-1)),","==b.substring(b.length-1)&&(b=b.substring(0,b.length-1)),"-"==b.substring(b.length-1)&&(b=b.substring(0,b.length-1)),b+='...<span class="read-more">Read More&nbsp;&raquo; </span>'}}),l=Backbone.View.extend({officers:new i,initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.officers=a.officers,this.officers.on("reset",this.render.bind(this)),this.template=_.template(d("#officer-tmpl").html()),this.render(),this},render:function(){var a=this,b="";return this.$el.html(""),this.officers.length?(this.officers.each(function(c){b+=a.template({model:c.toJSON()})}),this.$el.html(b)):this.$el.html('<div class="loading">LOADING...</div>'),this}}),m=Backbone.View.extend({initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.officerList=a.officerList,this.officers=a.officers,this.initTypeahead(),this},initTypeahead:function(){var a=this;d(".typeahead").keyup(function(){var b=d(".detail-page"),c=d("detail-officer"),e=d("detail-case"),f=d(this).val().toLowerCase();f.length>0?(d(".officer").each(function(){a.filterOfficers(this,f)}),b&&(d("body").removeClass("detail-page"),d("body").removeClass("detail-case"),d("body").removeClass("detail-officer"))):c.length>0?(d("body").addClass("detail-page"),d("body").addClass("detail-officer"),d(".officer").show()):e>0?(d("body").addClass("detail-page"),d("body").addClass("detail-case")):d(".results-wrapper-inner .officer").show()})},filterOfficers:function(a,b){var c=d(a),e=c.find("h2"),f=c.find(".badge-num"),g=c.find(".slug"),h=(e.text()+f.text()+g.text()).toLowerCase();h.indexOf(b)>=0?c.show():c.hide()}}),n=Backbone.View.extend({initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.filterData=a.filterData,this.template=_.template(d("#case-search-statement-tmpl").html()),this.caseList=a.caseList,this},render:function(){if("undefined"==typeof this.filterData)return!1;var a=this,b=_.extend(this.filterData,{incidents:this.languagize(this.caseList.case_numbers.length),payments:_.reduce(this.caseList.cases.filter(function(b){return _.indexOf(a.caseList.case_numbers,b.get("case_number"))>=0?b:void 0}),function(a,b){return a+b.get("total_payments")},0)}),c=this.template(b);this.$el.html(c.trim()),d("#search-intro").hide()},languagize:function(a){return 10>a&&(0==a&&(a="no"),1==a&&(a="one"),2==a&&(a="two"),3==a&&(a="three"),4==a&&(a="four"),5==a&&(a="five"),6==a&&(a="six"),7==a&&(a="seven"),8==a&&(a="eight"),9==a&&(a="nine")),a}}),o=Backbone.View.extend({events:{"change :input":"handleChange"},initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.filterData=this.$el.serializeObject(),this.cases=a.cases,this.caseList=a.caseList,this.initChosen(),this.initTags(),this},handleChange:function(){this.filterData=this.$el.serializeObject(),this.filterCases(),this.updateStatement(),d(".search").removeClass("expanded"),d("body").removeClass("detail-page"),d("body").removeClass("detail-case"),d("body").removeClass("detail-officer")},updateStatement:function(){"undefined"==typeof this.caseSearchStatement&&(this.caseSearchStatement=new n({filterdata:this.filterData,el:"#case-search-statement",caseList:this.caseList})),this.caseSearchStatement.filterData=this.filterData,this.caseSearchStatement.render(),adjust_whitespace();var a=d(".clear-filters"),b=d(".filter-statement").hide(),c=d(".search-statement-wrapper");""==this.filterData.neighborhood&&""==this.filterData.primary_causes[0]&&""==this.filterData.total_payments&&d("#case-search-form input[type=checkbox]:checked").length<1?(a.hide(),b.hide(),c.removeClass("filtered")):(a.show(),b.show(),c.addClass("filtered")),d(".clickable .x").click(function(){var a=(d(this),d(this).closest(".clickable.neighborhood").length),b=d(this).closest(".clickable.payment_amount").length,c=d(this).closest(".clickable.primary_cause").length,e=d(this).closest(".clickable.tag").length;if(a>0)d("#neighborhood").chosen().prop("selectedIndex",0).change().trigger("chosen:updated");else if(b>0)d("#payment_amount").chosen().prop("selectedIndex",0).change().trigger("chosen:updated");else if(c>0)d("#primary_cause").chosen().prop("selectedIndex",0).change().trigger("chosen:updated");else if(e>0){var f=d(this).parent().data("val");d("#case-search-form input[type=checkbox]:checked").each(function(){var a=d(this),b=d(this).val().toLowerCase();f==b&&a.attr("checked",!1).change()})}}),a.click(function(){d("#case-search-form input[type=checkbox]:checked").attr("checked",!1).change(),d("#case-search-form select").chosen().prop("selectedIndex",0).change().trigger("chosen:updated"),d(".typeahead").val("").trigger("keyup"),a.unbind("click")})},filterCases:function(){var a=this,b=[];this.cases.each(function(c){var e=!0;_.each(a.filterData,function(a,b){if(""!=a){if(["neighborhood"].indexOf(b)>=0&&"neighborhood"==b&&("unknown"==a?"undefined"!=typeof c.get(b)&&(e=!1):c.get(b)!==a&&(e=!1)),"total_payments"==b){var f=a.split("-"),g=Number(f[0]),h=Number(f[1]),i=Number(c.get("total_payments"));i>=g&&h>=i||(e=!1)}if("primary_causes"==b&&a.indexOf(c.get("primary_cause"))<0&&(e=!1),"tags"==b){var j=c.get("tags").toLowerCase(),k=!0;d("input:checked").each(function(){var a=d(this).attr("value");return j.indexOf(a)>=0?void(k=!0):(k=!1,!1)}),k||(e=!1)}}}),e&&b.push(c.get("case_number"))}),this.caseList.renderFiltered(b)},initChosen:function(){this.$el.find("select.chosen").chosen()},initTags:function(){d("#tag-toggle").click(function(){d(this).toggleClass("expanded"),d("#tag-group").toggle()})}}),p=Backbone.View.extend({initialize:function(a){return this.$el.chosen({width:"200px",disable_search:!0}),this.caseList=a.caseList,this.caseList.cases.on("sort",this.caseList.renderFiltered.bind(this.caseList)),Backbone.View.prototype.initialize.apply(this,arguments),this},events:{change:"sortCaseList"},sortCaseList:function(a){var b=d(a.currentTarget).val();this.caseList.sortElements(b)}}),q=Backbone.View.extend({events:{"click .tab-selector a":"goToTab"},initialize:function(a){return this.cases=a.cases,this.caseList=a.caseList,this.officers=a.officers,this.officerList=a.officerList,Backbone.View.prototype.initialize.apply(this,arguments),this},goToTab:function(a,b){var c;return c="string"==typeof a?"search/"+a:d(a.currentTarget).attr("href").replace(Backbone.history.root,""),"cases"==a?(d("body").removeClass("filter-officers"),d("body").addClass("filter-cases"),"undefined"==typeof this.caseForm&&(this.caseForm=new o({el:"#case-search-form",cases:this.cases,caseList:this.caseList})),this.caseForm.filterCases()):(d("body").removeClass("filter-cases"),d("body").addClass("filter-officers"),"undefined"==typeof this.officerForm&&(this.officerForm=new m({el:"#officer-search-form",officers:this.officers,officerList:this.officerList}))),b?void 0:(Backbone.history.navigate(c,{trigger:!0}),!1)}});Number.prototype.formatMoney=function(a,b,c){var d=this,a=isNaN(a=Math.abs(a))?2:a,b=void 0==b?".":b,c=void 0==c?",":c,e=0>d?"-":"",f=parseInt(d=Math.abs(+d||0).toFixed(a))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+c:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+c)+(a?b+Math.abs(d-f).toFixed(a).slice(2):"")},d(document).ready(function(){window.router=new e,Backbone.history.start({pushState:!0,root:site_path})})}();