!function(){function b(b){var c=[],d=b;for(a in d)c.push(d[a]);return c.sort(function(a,b){var c=Date.parse(a.date_of_incident),d=Date.parse(b.date_of_incident);return d>c?1:c>d?-1:0}),c}function c(b){var c=[],d=b;for(a in d)c.push(d[a]);return c.sort(function(a,b){var c=a.last.toLowerCase(),d=b.last.toLowerCase();return d>c?-1:c>d?1:0}),c}function d(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="; expires="+d.toGMTString()}else var e="";document.cookie=a+"="+b+e+"; path=/"}function e(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null}function f(){if(window.location.href.match(/(search|case|officer)/)){var a=e("cpd-disclaimer");a||(g(),d("cpd-disclaimer",1,7))}}function g(){var a='<div class="disclaimer-overlay"><div class="disclaimer-container"><div class="disclaimer-close">close</div><h3>Disclaimer</h3><p>This database aims to summarize the complaint, the Chicago police officers named, and the settlement/judgment amount, and does not purport to summarize the entire legal proceeding. Information in this database is based on civil complaints filed against police officers and/or the city of Chicago, other federal and state court records, and City of Chicago records. Complaints are legal documents that set out the plaintiff’s perception of facts and are not necessarily a full or accurate account of the events. A settlement or judgment in a case is not an indication that every allegation made in the complaint is true. In fact, the city and police officers typically deny many or all of the allegations, and the court may dismiss some “causes of action,” or alleged violations of the law, before settlement. This database reflects the causes of action in the complaint and makes no representation as to what causes of action remained in each case at the time of settlement. In addition, the database includes only defendants who were Chicago Police Department personnel and makes no representation as to additional defendants who may have been named in the case. The Chicago Reporter is not responsible for inaccuracies caused by errors in the underlying data obtained from official sources.</p></div></div>';h("body").append(a);var b=h(".disclaimer-overlay");b.click(function(){var a=h(event.target);!a.closest(".disclaimer-container").length>0?b.remove():a.hasClass("disclaimer-close")&&b.remove()})}var h=jQuery,i=Backbone.Router.extend({routes:{search:"cases","search/":"cases","search/index.html":"cases","search/officers":"officers","search/cases":"cases","search/officers/":"officers","search/officers/index.html":"officers","search/cases/":"cases","search/cases/index.html":"cases","case/*path":"case_detail","officer/*path":"officer_detail"},initialize:function(){var a=this;return this.caseCollection=new k,this.caseList=new o({el:"#case-list-view",cases:this.caseCollection}),this.officerCollection=new m,this.officerList=new p({el:"#officer-list-view",officers:this.officerCollection}),this.searchSelector=new u({el:"#tabs",cases:this.caseCollection,caseList:this.caseList,officers:this.officerCollection,officerList:this.officerList}),this.loadData(function(){cases_json=b(cases_json),officers_json=c(officers_json);for(var d=cases_json.length,e=0,f=0;d>f;f++)e+=cases_json[f].total_payments;h("#search-intro").text("These "+d+" lawsuits cost Chicago a total of $"+Number(e).formatMoney(0)+"."),a.officerCollection=a.officerCollection.reset(officers_json),a.caseCollection=a.caseCollection.reset(cases_json)}),Backbone.Router.prototype.initialize.apply(this,arguments),this},loadData:function(a){if("undefined"==typeof cases_json&&"undefined"==typeof officers_json){var b=site_path+"assets/cpd_settlements/data/combined.min.js";h.ajax({url:b,cache:!0,dataType:"script",success:a})}},officers:function(){return this.searchSelector.goToTab("officers"),!1},officer_detail:function(){return this.searchSelector.goToTab("officers",!0),!1},cases:function(){return this.searchSelector.goToTab("cases"),!1},case_detail:function(){return this.searchSelector.goToTab("cases",!0),!1}}),j=Backbone.Model.extend({}),k=Backbone.Collection.extend({model:j}),l=Backbone.Model.extend({}),m=Backbone.Collection.extend({model:l,comparator:"last"}),n=Backbone.Model.extend({}),l=(Backbone.Collection.extend({model:n,comparator:"neighborhood"}),Backbone.Model.extend({})),m=Backbone.Collection.extend({model:l}),o=Backbone.View.extend({cases:new k,case_numbers:[],initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.template=_.template(h("#case-tmpl").html()),this.cases=a.cases,this.cases.on("reset",this.render.bind(this)),this.listSorter=new t({caseList:this,el:"#case-list-sort"}),this.render(),this},render:function(){var a=this,b="";return this.cases.length?(this.$el.html(""),this.cases.each(function(c){b+=a.template({model:c.toJSON()})}),this.$el.html(b)):this.$el.html('<div class="loading">Loading...</div>'),this},sortElements:function(a){var b;switch(a){case"payment-low-high":b=this.lowtohigh;break;case"payment-high-low":b=this.hightolow;break;case"date-newest-oldest":b=this.newtoold;break;case"date-oldest-newest":b=this.oldtonew;break;default:b=this.newtoold}var c=this.$el.children(".case");c.sort(b),c.detach().appendTo(this.$el)},renderFiltered:function(a){a?this.case_numbers=a:a=this.case_numbers;var b=this;return this.$el.find(".case").hide(),_.each(a,function(a){b.$el.find('[data-case_number="'+a+'"]').show()}),this},hightolow:function(a,b){var c=Number(h(a).data("total_payments")),d=Number(h(b).data("total_payments"));return d>c?1:c>d?-1:0},lowtohigh:function(a,b){var c=Number(h(a).data("total_payments")),d=Number(h(b).data("total_payments"));return d>c?-1:c>d?1:0},newtoold:function(a,b){var c=Date.parse(h(a).data("date_of_incident")),d=Date.parse(h(b).data("date_of_incident"));return d>c?1:c>d?-1:0},oldtonew:function(a,b){var c=Date.parse(h(a).data("date_of_incident")),d=Date.parse(h(b).data("date_of_incident"));return d>c?-1:c>d?1:0},formatStr:function(a){var b="";return b=a.match(/^(\r\n|.){1,220}\b/g).join("")," "==b.substring(b.length-1)&&(b=b.substring(0,b.length-1)),","==b.substring(b.length-1)&&(b=b.substring(0,b.length-1)),"-"==b.substring(b.length-1)&&(b=b.substring(0,b.length-1)),b+='...<span class="read-more">Read More&nbsp;&raquo; </span>'}}),p=Backbone.View.extend({officers:new m,initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.officers=a.officers,this.officers.on("reset",this.render.bind(this)),this.template=_.template(h("#officer-tmpl").html()),this.render(),this},render:function(){var a=this,b="";return this.$el.html(""),this.officers.length?(this.officers.each(function(c){b+=a.template({model:c.toJSON()})}),this.$el.html(b)):this.$el.html('<div class="loading">LOADING...</div>'),this}}),q=Backbone.View.extend({initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.officerList=a.officerList,this.officers=a.officers,this.initTypeahead(),this},initTypeahead:function(){var a=this;h(".typeahead").keyup(function(){var b=h(".detail-page"),c=h("detail-officer"),d=h("detail-case"),e=h(this).val().toLowerCase();e.length>0?(h(".officer").each(function(){a.filterOfficers(this,e)}),b&&(h("body").removeClass("detail-page"),h("body").removeClass("detail-case"),h("body").removeClass("detail-officer"))):c.length>0?(h("body").addClass("detail-page"),h("body").addClass("detail-officer"),h(".officer").show()):d>0?(h("body").addClass("detail-page"),h("body").addClass("detail-case")):h(".results-wrapper-inner .officer").show()})},filterOfficers:function(a,b){var c=h(a),d=c.find("h2"),e=c.find(".badge-num"),f=c.find(".slug"),g=(d.text()+e.text()+f.text()).toLowerCase();g.indexOf(b)>=0?c.show():c.hide()}}),r=Backbone.View.extend({initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.filterData=a.filterData,this.template=_.template(h("#case-search-statement-tmpl").html()),this.caseList=a.caseList,this},render:function(){if("undefined"==typeof this.filterData)return!1;var a=this,b=_.extend(this.filterData,{incidents:this.languagize(this.caseList.case_numbers.length),payments:_.reduce(this.caseList.cases.filter(function(b){return _.indexOf(a.caseList.case_numbers,b.get("case_number"))>=0?b:void 0}),function(a,b){return a+b.get("total_payments")},0)}),c=this.template(b);this.$el.html(c.trim()),h("#search-intro").hide()},languagize:function(a){return 10>a&&(0==a&&(a="no"),1==a&&(a="one"),2==a&&(a="two"),3==a&&(a="three"),4==a&&(a="four"),5==a&&(a="five"),6==a&&(a="six"),7==a&&(a="seven"),8==a&&(a="eight"),9==a&&(a="nine")),a}}),s=Backbone.View.extend({events:{"change :input":"handleChange"},initialize:function(a){return Backbone.View.prototype.initialize.apply(this,arguments),this.filterData=this.$el.serializeObject(),this.cases=a.cases,this.caseList=a.caseList,this.initChosen(),this.initTags(),this},handleChange:function(){this.filterData=this.$el.serializeObject(),this.filterCases(),this.updateStatement(),h(".search").removeClass("expanded"),h("body").removeClass("detail-page"),h("body").removeClass("detail-case"),h("body").removeClass("detail-officer")},updateStatement:function(){"undefined"==typeof this.caseSearchStatement&&(this.caseSearchStatement=new r({filterdata:this.filterData,el:"#case-search-statement",caseList:this.caseList})),this.caseSearchStatement.filterData=this.filterData,this.caseSearchStatement.render(),adjust_whitespace();var a=h(".clear-filters"),b=h(".filter-statement").hide(),c=h(".search-statement-wrapper");""==this.filterData.neighborhood&&""==this.filterData.primary_causes[0]&&""==this.filterData.total_payments&&h("#case-search-form input[type=checkbox]:checked").length<1?(a.hide(),b.hide(),c.removeClass("filtered")):(a.show(),b.show(),c.addClass("filtered")),h(".clickable .x").click(function(){var a=(h(this),h(this).closest(".clickable.neighborhood").length),b=h(this).closest(".clickable.payment_amount").length,c=h(this).closest(".clickable.primary_cause").length,d=h(this).closest(".clickable.tag").length;if(a>0)h("#neighborhood").chosen().prop("selectedIndex",0).change().trigger("chosen:updated");else if(b>0)h("#payment_amount").chosen().prop("selectedIndex",0).change().trigger("chosen:updated");else if(c>0)h("#primary_cause").chosen().prop("selectedIndex",0).change().trigger("chosen:updated");else if(d>0){var e=h(this).parent().data("val");h("#case-search-form input[type=checkbox]:checked").each(function(){var a=h(this),b=h(this).val().toLowerCase();e==b&&a.attr("checked",!1).change()})}}),a.click(function(){h("#case-search-form input[type=checkbox]:checked").attr("checked",!1).change(),h("#case-search-form select").chosen().prop("selectedIndex",0).change().trigger("chosen:updated"),h(".typeahead").val("").trigger("keyup"),a.unbind("click")})},filterCases:function(){var a=this,b=[];this.cases.each(function(c){var d=!0;_.each(a.filterData,function(a,b){if(""!=a){if(["neighborhood"].indexOf(b)>=0&&"neighborhood"==b&&("unknown"==a?"undefined"!=typeof c.get(b)&&(d=!1):c.get(b)!==a&&(d=!1)),"total_payments"==b){var e=a.split("-"),f=Number(e[0]),g=Number(e[1]),i=Number(c.get("total_payments"));i>=f&&g>=i||(d=!1)}if("primary_causes"==b&&a.indexOf(c.get("primary_cause"))<0&&(d=!1),"tags"==b){var j=c.get("tags").toLowerCase(),k=!0;h("input:checked").each(function(){var a=h(this).attr("value");return j.indexOf(a)>=0?void(k=!0):(k=!1,!1)}),k||(d=!1)}}}),d&&b.push(c.get("case_number"))}),this.caseList.renderFiltered(b)},initChosen:function(){this.$el.find("select.chosen").chosen()},initTags:function(){h("#tag-toggle").click(function(){h(this).toggleClass("expanded"),h("#tag-group").toggle()})}}),t=Backbone.View.extend({initialize:function(a){return this.$el.chosen({width:"200px",disable_search:!0}),this.caseList=a.caseList,this.caseList.cases.on("sort",this.caseList.renderFiltered.bind(this.caseList)),Backbone.View.prototype.initialize.apply(this,arguments),this},events:{change:"sortCaseList"},sortCaseList:function(a){var b=h(a.currentTarget).val();this.caseList.sortElements(b)}}),u=Backbone.View.extend({events:{"click .tab-selector a":"goToTab"},initialize:function(a){return this.cases=a.cases,this.caseList=a.caseList,this.officers=a.officers,this.officerList=a.officerList,Backbone.View.prototype.initialize.apply(this,arguments),this},goToTab:function(a,b){f();var c;return c="string"==typeof a?"search/"+a:h(a.currentTarget).attr("href").replace(Backbone.history.root,""),"cases"==a?(h("body").removeClass("filter-officers"),h("body").addClass("filter-cases"),"undefined"==typeof this.caseForm&&(this.caseForm=new s({el:"#case-search-form",cases:this.cases,caseList:this.caseList})),this.caseForm.filterCases()):(h("body").removeClass("filter-cases"),h("body").addClass("filter-officers"),"undefined"==typeof this.officerForm&&(this.officerForm=new q({el:"#officer-search-form",officers:this.officers,officerList:this.officerList}))),b?void 0:(Backbone.history.navigate(c,{trigger:!0}),!1)}});Number.prototype.formatMoney=function(a,b,c){var d=this,a=isNaN(a=Math.abs(a))?2:a,b=void 0==b?".":b,c=void 0==c?",":c,e=0>d?"-":"",f=parseInt(d=Math.abs(+d||0).toFixed(a))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+c:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+c)+(a?b+Math.abs(d-f).toFixed(a).slice(2):"")},h(document).ready(function(){window.router=new i,Backbone.history.start({pushState:!0,root:site_path})})}();