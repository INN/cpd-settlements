<script type="text/javascript">
  var site_path = '{{ site_path }}';
</script>

{% if BUILD_PATH %}
  <script type="text/javascript" src="{{ url_for('cpd_settlements.static', filename='data/combined.min.js') }}"></script>
{% else %}
  <script type="text/javascript" src="{{ url_for('cpd_settlements.static', filename='data/cases.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('cpd_settlements.static', filename='data/officers.js') }}"></script>
{% endif %}

{% if BUILD_PATH %}
  <script type="text/javascript" src="{{ url_for('cpd_settlements.static', filename='js/search-libs.min.js') }}"></script>
{% else %}
  <script type="text/javascript" src="{{ url_for('cpd_settlements.static', filename='vendor/chosen/chosen.jquery.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('cpd_settlements.static', filename='vendor/jquery-serialize-object/jquery.serialize-object.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('cpd_settlements.static', filename='js/search.js') }}"></script>
{% endif %}

<script type="text/template" id="case-tmpl">
    <div class="case" data-case_number="<%= model.case_number %>" onclick="location.href='<%= site_path %>case/<%= model.slug %>'">
      <div class="card-row">
        <div class="case-payment-wrapper">
          <h4><%= model.case_number %></h4>
          <div class="case-payment">
            <h2>$<%= Number(model.total_payments).formatMoney(0) %></h2>
            <h3><%= model.primary_cause %></h3>
          </div>
        </div>

        <div class="case-description">
          <ul class="case-details">
            <li>
              <span class="card-label">Plaintiff: </span>
              <% _.each(model.victims, function(victim) { %>
              <%= victim.victim_1 %>
              <% }) %>
            </li>
            <li><span class="card-label">Incident date: </span><% if (model.date_of_incident !== '') { %><%= model.date_of_incident %><% } else { %>Not specified<% } %></li>
            <li><span class="card-label">Location: </span><% if (model.address !== '') { %><%= model.address %><% } else { %>Not specified<% } %></li>
          </ul>

          <% if (model.narrative !== 'NULL') { %>
          <div class="case-summary">
            <span class="card-label">Case summary: </span>
            <p><%= this.formatStr(model.narrative) %></p>
          </div>
          <%  } %>

          <p style="display:none;"><%= model.tags %></p>

          <% if ( model.officers.length > 0){ %>
          <div class="case-officers">
            <span class="card-label">Officers involved:</span>
            <div class="officer-group">
              <% _.each(model.officers, function(officer) { %>
              <a href="<%= site_path %>officer/<%= officer.slug %>" class="police-icon" data-firstname="<%= officer.first %>" data-lastname="<%= officer.last %>"><div class="tooltip"><%= officer.first %> <%= officer.last %></div></a>
             <% }) %>
             </div>
          </div>
          <% } %>
        </div>
      </div>
    </div>
</script>

<script type="text/template" id="officer-tmpl">
<div class="officer" data-slug="<%= model.slug %>">
  <div class="officer-logo"></div>
  <div class="officer-text">
    <h2><a href="<%= site_path %>officer/<%= model.slug %>"><%= model.prefix %> <%= model.first %> <%= model.last %></a></h2>
    <h3><%= model.prefix %></h3>
    <div class="ids"><span class="badge-num"><%= model.badge_number %></span><span class="slug"><%= model.slug %></span></div>
    <div class="total-payments-container"><span class="total-payments">$<%= Number(model.total_payments).formatMoney(0) %></span> <span>total payments<!--  for all related cases --></span></div>
  </div>
</div>
</script>

<script type="text/tmpl" id="case-search-statement-tmpl">
  <% var checkboxes = $('input[type=checkbox]:checked'); cblength = checkboxes.length; %> 
  <% var primary_cause = $('#primary_cause').val().replace(/ /g, '\u00a0').toLowerCase(); %> 
  <% var payment_amount = $('#payment_amount').val() %>
  
  <span class="number-of-incidents"><%= incidents %> </span>
  
  <% if ( payment_amount !== "" ) { %> 
    <span class="clickable payment_amount"><% print($('#payment_amount option:selected').html()) %><span class="x">x</span></span>   
  <% } %>

  <% if ( incidents !== "one" ) { %> 
    settlements
  <% } else { %>
    settlement
  <% } %>

  <% if ( cblength > 0 ) { %> 

    <% if ( primary_cause == "" && neighborhood == "" ) { %>
      <% if ( incidents !== "one" ) { %> 
        were
      <% } else if ( incidents == "one" ) { %>
        was
      <% } %>
      tagged 
      <% _.each(checkboxes, function(tag, i) { %>
        <span class="clickable tag"><% print($(tag).val()) %><span class="x">x</span></span>
        <% if ( i > -1 && i < cblength-1 && i != cblength-2) { %> 
          , 
        <% } %>
        <% if ( cblength > 1 && i == cblength-2 ) { %> 
           and
        <% } %>
      <% }) %>. <!--there's the period -->
    <% } else { %>

      &mdash; tagged 
      <% _.each(checkboxes, function(tag, i) { %>
        <span class="clickable tag"><% print($(tag).val()) %><span class="x">x</span></span>
        <% if ( i > -1 && i < cblength-1 && i != cblength-2) { %> 
          , 
        <% } %>
        <% if ( cblength > 1 && i == cblength-2 ) { %> 
           and
        <% } %>
      <% }) %>
      &mdash; 

    <% } %>
  <% } %>

  <% if ( primary_cause !== "" ) { %> 
    resulted from 
    <% if ( incidents !== "one" ) { %> 
      incidents 
    <% } else { %>
      an incident
    <% } %>
    of <span class="clickable primary_cause"><%= primary_cause %><span class="x">x</span></span>
    <% if ( neighborhood == "" || neighborhood == "unknown" ) { %>.<% } %> <!--there's another period-->
  <% } %>

  <% if ( neighborhood !== "" && neighborhood !== "unknown" ) { %>     

    <% if ( cblength == 0 && primary_cause == "" && payment_amount == "" ) { %> 
      resulted from incidents
    <% } %>

    near <span class="clickable neighborhood"><%= neighborhood %>.<span class="x">x</span></span>
  <% } %><br ><br >

  <% if ( incidents !== "one" ) { %> 
    These <%= incidents %> settlements cost Chicago a total of $<%= payments.formatMoney(0) %>.
  <% } else { %>
    This settlement cost Chicago $<%= payments.formatMoney(0) %>.
  <% } %>

  <div class="clear-filters"><span class="x">x</span> clear all filters</div>
</script>
