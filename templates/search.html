{% extends "templates/_base.html" %}

{% block bodyattrs %}class="page-{{ PATH[:-5] }} {{ init_view }}"{% endblock bodyattrs %}

{% block library_css %}
{{ super() }}

{{ CSS.push('vendor/seiyria-bootstrap-slider/dist/css/bootstrap-slider.min.css') }}
{{ CSS.push('vendor/chosen/chosen.css') }}
{{ CSS.push('css/style.css') }}
{{ CSS.render('css/style.min.css') }}

<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans+Condensed:700' rel='stylesheet' type='text/css'>
{% endblock library_css %}

{% block content %}
<div class="container">
  <div class="jumbotron">
    <h1>Cases</h1>
    <h2>The City of Chicago paid {{ total_for_payments(payments) }} in {{ cases|length }} legal settlements in police misconduct cases between January 2012 and June 2015.</h2>
  </div>
  <div class="search row">
    <div class="col-xs-12" id="tabs">
      <ul id="search-selector" class="tab-selector">
        <li><a href="/search/cases">Filter cases</a></li>
        <li><a href="/search/officers">Officer search</a></li>
      </ul>
      <div class="tab-containers">
        <div data-tab-id="cases" class="tab-container case-tab">
          {% include 'templates/_case_search_form.html' %}
        </div>
        <div data-tab-id="officers" class="tab-container officer-tab">
          {% include 'templates/_officer_search_form.html' %}
        </div>
      </div>
    </div>
  </div>

  <div class="case-list row">
    <div class="col-xs-12">
      <h3>Results</h3>
      <div class="case-list-sort-container">
        <label for="case-list-sort">Sort by:</label>
        <select id="case-list-sort" class="chosen" style="float: right">
          <option value="payment-high-low">Payment, high to low</option>
          <option value="payment-low-high">Payment, low to high</option>
        </select>
      </div>
    </div>
    <div class="col-xs-12">
      <div class="case-list-inner" id="case-list-view">
        {% for case in cases %}
          {% include 'templates/_case.html' %}
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="officer-list row">
    <div class="col-xs-12">
      <h3>Officers</h3>
    </div>
    <div class="col-xs-12">
      <div class="officer-list-inner" id="officer-list-view">
        {% for officer in officers %}
          {% include 'templates/_officer.html' %}
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block library_scripts %}

{{ super() }}

<script type="text/javascript">
  var site_path = '{{ site_path }}';
  var cases_json = {{ cases_json|safe }};
  var officers_json = {{ officers_json|safe }};
</script>

{{ JS.push('vendor/chosen/chosen.jquery.js') }}
{{ JS.push('vendor/typeahead.js/dist/typeahead.bundle.js') }}
{{ JS.push('vendor/seiyria-bootstrap-slider/dist/bootstrap-slider.js') }}
{{ JS.push('vendor/jquery-serialize-object/jquery.serialize-object.js') }}
{{ JS.push('js/search.js') }}
{{ JS.render('js/search.min.js') }}

<script type="text/template" id="case-tmpl">
  <div class="case" data-case_number="<%= model.case_number %>">

    <h2>$<%= Number(model.total_payments).formatMoney() %> for <%= model.primary_cause %></h2>

    <h3>Victim:</h3>
     <% _.each(model.victims, function(victim) { %>
      <p><%= victim.victim_1 %></p>
     <% }) %>

    <h3>Officers involved:</h3>
     <% _.each(model.officers, function(officer) { %>
      <p><%= officer.first %> <%= officer.last %> <% if (officer.badge_number) { %>(badge: <%= officer.badge_number %>)<% } %></p>
     <% }) %>

     <ul class="case-details">
       <li>Case number: <%= model.case_number %></li>
       <li>Incident date: <%= model.date_of_incident %></li>
       <li>Location: <% if (model.address !== '') { %><%= model.address %><% } else { %>Not specified<% } %></li>
     </ul>
  </div>
</script>

<script type="text/template" id="officer-tmpl">
  <div class="officer" data-case_number="<%= model.case_number %>">
    <h2><a href="<%= site_path %>officers/<%= model.slug %>"><%= model.prefix %> <%= model.first %> <%= model.last %></a></h2>
    <div class="badge-num"><span>Badge #:</span> <%= model.badge_number %></div>
    <div class="total-payments-container"><span class="total-payments">$<%= Number(model.total_payments).formatMoney() %></span> <span>total payments for all related cases</span><div>
  </div>
</script>

<script type="text/tmpl" id="case-search-statement-tmpl">
<span class="clickable"><%= incidents %></span> incidents<% if ( neighborhood !== "" && neighborhood !== "unknown" ) { %> near <span class="clickable"><%= neighborhood %></span><% } %>
<% if (date_of_incident !== "") { %>from <span class="clickable"><%= date_of_incident %></span><% } %>
resulted in payments totalling <span class="clickable">$<%= payments.formatMoney() %></span>
<% if ( victim_1_race !== "" ) { %> where the victim's race was <span class="clickable"><%= victim_1_race %></span><% } %>
</script>
{% endblock %}
